<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

<title>Comentarios de los usuarios</title>

<link href="css/BookingHav.css" rel="stylesheet" type="text/css">

</head>

<body>
<!--------------------------------------- Encabezamiento ----------------------------------------->
<div class="header"> 
  <a href="index.html"><img class="logo" src="images/LogoBH.svg" alt="logo"/></a>
  <div class="menu-btn"><img src="images/menu.svg" alt="menu"/></div>
  <div class="menu"> 
    <div class="item"> Inicio </div>
    <div class="item"> <img class="icon_M" src="images/login.svg" alt="" /><span id="User"></span></div>
  </div>
</div>
    
<!--------------------------------------- Listado de Comentarios  -------------------------------------->
<div id="ViewComents">
  <div class="frame">
    <h2><span>Comentarios casa: <span id="csName" ></span></span></h2>
    
    <div id="ListComents">
    </div>
    
    <div id="DataComents" class="UpSep">
      <div><input    id="UName" class="LineInput" type="text" placeholder="Nombre del usuario"/></div>
      <div><textarea id="Texto" class="LineInput" rows="8" placeholder="Escriba su comentario"></textarea></div>
      <div id="bntAddComent" class="btnRight">Comentar</div>
    </div>
    
  </div>
</div>

<!------------------------------------------ Footer ---------------------------------------------->
<div id="PageFooter">
  <div class="content">
    <div class="block contacto">
      <div class="Title">Nosotros</div>
      <div class="text">
        <div><img src="images/GrupoBH.jpg" alt="" style="width:100%" /> </div>
      </div>
    </div>
      
    <div class="block correo">
      <div class="Title"> Booking Havana </div>
      <div> Agencia gestora de alojamiento para casas particulares de alquiler en Cuba. </div>
      <br/>
      <div class="text">Dirección:</div>
      <div class="text">Calle 13 # 1054, entre 12 y 14</div>
      <div class="text">Vedado, La Habana, Cuba</div>
      <br/>
      <div class="text">Cel: +53 53465756 </div>
      <div class="text gmail"><a href=""><img src="images/Correo.png" alt=""/>Alex@bookinghavana.com </a></div>
    </div>
  
    <div class="block Pages">
      <div class="Title"> Páginas </div>
      <div class="text">
        <div><a href="politica-de-privacidad.php"> • Política de Privacidad.</a></div>
        <div><a href="terminos-y-condiciones.php"> • Términos y condiciones</a></div>
        <div><a href="javascript:EditCasa()"> • <span id="lnkEdProp">Inscribir</span> propiedad</a></div>
        <div><a href="enlaces-de-interes.php"> • Enlaces de interés</a></div>
        <div><a href="acerca-de-nosotros.php"> • Acerca de nosotros</a></div>
      </div>
    </div>
  </div>  

<div class="rigths">© Booking Havana 2015 All rights reserved </div>

 </div>  

<!------------------------------------------------------------------------------------------------>
<!--  Segmentos de manejo dinamico                                                             --->
<!------------------------------------------------------------------------------------------------>
<div id="HidedBoxs" style="display:none">

<!-- Cuadro para loguearse o crear usuario nuevo -->
<div id="BoxUser" class="BoxFloat">
  <div id="LogIn" >
    <div><input class="LineInput" type="text"     placeholder="Usuario o Correo"/></div>
    <div><input class="LineInput" type="password" placeholder="Contraseñas"/></div>
    <div class="MsgError" ></div>
    <div class="btnRight">Entrar</div>
    <div class="btnLeft">&lt;&lt;</div>
  </div>
  
  <div id="NewUser" >
    <div><input class="LineInput" type="text"     placeholder="Correo electronico"/></div>
    <div><input class="LineInput" type="text"     placeholder="Usuario"/></div>
    <div><input class="LineInput" type="password" placeholder="Contraseñas"/></div>
    <div><input class="LineInput" type="password" placeholder="Confirmar contraseñas"/></div>
    <div><input class="isProp"    type="checkbox"/><label for="isProp">Propietario</label></div>
    <div><input class="LineInput Telef" type="text"     placeholder="Teléfono"/></div>
    <div class="MsgError" ></div>
    <div class="btnRight">Crear</div>
    <div class="btnLeft">&lt;&lt;</div>
  </div>
  
  <div id="EditUser" >
    <div><input class="LineInput" type="text"     placeholder="Correo electronico"/></div>
    <div><input class="LineInput" type="text"     placeholder="Usuario"/></div>
    <div><input class="LineInput" type="password" placeholder="Contraseñas"/></div>
    <div><input class="LineInput" type="password" placeholder="Confirmar contraseñas"/></div>
    <div><input class="isProp"    type="checkbox"/><label for="isProp">Propietario</label></div>
    <div><input class="LineInput Telef" type="text"     placeholder="Teléfono"/></div>
    <div class="MsgError" ></div>
    <div class="btnRight">Modificar</div>
    <div class="btnLeft">&lt;&lt;</div>
  </div>
  
  <div id="MsgActive" >
    <p>Hemos re-enviado el correo de validación del usuario.</p>
    <p>Revise su buzón, y siga el enlace para completar el proceso.</p>
    <div class="btnLeft">&lt;&lt;</div>
  </div>
  
  <div id="MsgPassWord" >
    <p>Le hemos enviado la contraseñas, a la direccion de correo electronico asociada al nombre de usuario.</p>
    <div class="btnLeft">&lt;&lt;</div>
  </div>
  
  <div id="MsgUpdate" >
    <p>Los datos del usuario actual, fueron actualizados satifactoriamente.</p>
    <p>Para que los cambios, tengan efecto hay que salir y volver a entrar</p>
    <div class="btnLeft">&lt;&lt;</div>
  </div>
  
  <div id="mnuUser" class="list">
    <div class="item-pu" cmd="1">Salir</div>
    <div class="item-pu" cmd="2">Entrar como Usuario</div>
    <div class="item-pu" cmd="3">Crear nuevo Usuario</div>
    <div class="item-pu" cmd="4">Editar datos de Usuario</div>
    <div class="item-pu" cmd="5">Inscribir propiedad</div>
  </div>
  
</div>

</div>

<br/>
<br/>
<br/>

<!------------------------------------------------------------------------------------------------>
<!-- CODIGO JAVASCRIPT  -->
<!------------------------------------------------------------------------------------------------>
<script src="js/jquery-1.11.2.min.js"></script>
<script src="js/BookingHav.js"></script>

<script type="text/javascript">

var Menu, IdCasa;

// Inicia manipuladores y variables, después de cargarse la página
$(function() 
  {
  Menu = new MainMenu(); 
  
  $("#bntAddComent").click( NuevoComentario );   
  
  IdCasa = localStorage.LastCasa;
  if( !IdCasa )
    {
    alert("No se pudo identificar la casa sobre la que se va a comentar");  
    window.location ="index.html";
    return;
    }

  DescargarComentarios();

  SetName();
  Menu.ChangeUser = SetName;
  });

// Pone el nombre de usuario por defecto
function SetName()
  {
  var User = GetLogUser();
  if( User.Id  )                       {$("#UName").val( User.Nombre );}
  else if( localStorage.LastUserName ) {$("#UName").val( localStorage.LastUserName );}
  }

// Muestra un cursor de espera
function ShowWait( idWait )
  {
  var htm = '<div id="WaitImg" class="wait-up">'+
              '<img src="images/wait-cur.gif" alt="" class="wait-cursor" style="width: 32px; height: 32px; margin-left:-16px;"/>'+
            '</div>';
            
  $(idWait).append( htm ); 
  
  this.Hide = function()
    { $('#WaitImg').remove(); };
  }


function NuevoComentario()
  {
  var User  = $("#UName").val().trim();
  var Texto = $("#Texto").val().trim();
  
  if( User.length===0  ) User = "Anonimo";
  if( Texto.length===0 )
    {
    alert("Escriba el texto del comentario");
    return;  
    }
  
  localStorage.LastUserName = User;
  DescargarComentarios( User, Texto );  
  }  
  
// Descarga la lista de comentarios del servidor
function DescargarComentarios( User, Texto )
  {
  var cur = new ShowWait("#DataComents");
  
  var Data  = 'IdCasa='+IdCasa;
  
  if( Texto )
    {
    var sUser = encodeURIComponent( User );
    var sText = encodeURIComponent( Texto );
    
    Data += '&sUser='+sUser +'&sText='+sText;
    }
  
  $.ajax({ url: "ComentsList.php", data: Data, type:"POST",
    complete: function( xhr )
      { 
      cur.Hide();
       
      checkReturn( xhr, function( datos )
        {
        $("#Texto").val("");
        $("#csName").text(datos.Name);
          
        var Comts = datos.Coments;
        var n = Comts.length;
        if( n== 0)
          {
          $("#ListComents").html( "<p>No hay ningún comentario todavia</p>" );
          }
        else    
          {
          $("#ListComents").html( "" );
          
          for(var i=0; i<n; ++i )
            {
            var htm = getHtmlComent( Comts[i] )
            $("#ListComents").append( htm ); 
            }
          }
        });
        
      $("#Texto").focus();  
      }
    });
    
  }
  
// Obtiene el código HTML para mostrar una casa
function getHtmlComent( cm )
  {
  var ht =
  '<div class="UpSep">'+
    '<span style="display:inline-block; font-weight:bold;">'+cm.UserName+'</span>'+
    '<span style="display:inline-block; font-weight:bold; float:right;">'+cm.Fecha+'</span>'+
    '<p>'+cm.Texto+'</p>'+
  '</div>';

  return ht;
  }

</script>  

</body>
</html>
